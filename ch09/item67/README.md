---

marp: true

---

# 아이템 67
# 최적화는 신중히 하라

---

# 최적화는 신중히 하라

최적화는 좋은 결과보다는 해로운 결과로 이어지기 쉽고, 섣불리 진행하면 특히 더 그렇다.

1. 하지 마라
2. 아직 하지 마라
3. 각각의 최적화 시도 전후로 성능을 측정하라

---

# 빠른 프로그램보다는 좋은 프로그램을 작성하라

* 성능 때문에 견고한 구조를 희생하지 말자.
* 좋은 프로그램이면 아키텍처 자체가 최적화할 수 있는 길을 안내한다.
* 좋은 프로그램은 정보 은닉 원칙을 통해 시스템에서 독립적으로 다시 설계할 수 있다.
* 시스템을 다시 작성함으로써 해결될 성능 문제를 방지하기 위해 설계 단계에서 성능을 염두해야 한다.

---

# 성능을 제한하는 설계를 피하라

* 컴포넌트끼리, 혹은 외부 시스템과의 소통 방식과 같은 설계 요소는 완성 후 변경하기 어렵다.
    * API, 네트워크 프로토콜, 영구 저장용 데이터 포맷 등
* 설계 단계에서 위 요소들에 경우 성능을 염두해야 한다.

---

# API를 설계할 때 성능에 주는 영향을 고려하라

* public 타입을 가변으로 만들면 불필요한 방어적 복사를 유발할 수 있다. (아이템 50)
* 상속이 아닌 컴포지션을 통해 구현해야 한다. (아이템 18)
* 인터페이스가 아닌 구현 타입을 사용하는 것은 좋지 않다. (아이템 64)
* 하지만 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.

---

# 최적화 시도 전후로 성능을 측정하라

* 최적화 해도 성능이 눈에 띄게 높이지 못하거나, 오히려 더 나빠질수도 있다.
* 최적화 시도가 시간만 허비하게 될 수 도 있다.
* 프로파일링 도구는 최적화에 도움을 줄 수 있다.
    * 개별 메서드의 소비 시간과 호출 횟수 같은 런타임 정보를 제공한다.
* 자바 코드의 성능을 알기 쉽게 보여주는 벤치마킹 프레임워크 JMH도 있다.

---

# 자바

* 자바는 프로그래머가 작성하는 코드와 cpu에서 수행하는 명령 사이의 '추상화 격차'가 커서 최적화로 인한 성능 변화를 일정하게 예측하기가 어렵다.
* 따라서 각 환경에서 최적화에 대해 각각 측정해봐야 한다.
